<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROM Browser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .tab:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .tab.active {
            background: rgba(255,255,255,0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .content {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            min-height: 500px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .search-box {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .search-box::placeholder {
            color: #666;
        }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .game-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            transition: transform 0.3s ease;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
        }
        
        .game-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .game-platform {
            color: #ccc;
            margin-bottom: 8px;
        }
        
        .game-rating {
            color: #ffd700;
            margin-bottom: 8px;
        }
        
        .game-summary {
            font-size: 0.9rem;
            line-height: 1.4;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        
        .game-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #45a049;
        }
        
        .btn-secondary {
            background: #2196F3;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #1976D2;
        }
        
        .platforms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .platform-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .platform-card:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-3px);
        }
        
        .platform-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .platform-dataset {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .settings-section {
            margin-bottom: 30px;
        }
        
        .settings-section h3 {
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .setting-group {
            margin-bottom: 20px;
        }
        
        .setting-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .setting-input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 6px;
            background: rgba(255,255,255,0.9);
            color: #333;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
        }
        
        .error {
            background: rgba(255,0,0,0.2);
            border: 1px solid rgba(255,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .success {
            background: rgba(0,255,0,0.2);
            border: 1px solid rgba(0,255,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ ROM Browser</h1>
            <p>Your Complete ROM Management Solution</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('library')">üìö My Library</button>
            <button class="tab" onclick="showTab('browser')">üåê Myrient Browser</button>
            <button class="tab" onclick="showTab('settings')">‚öôÔ∏è Settings</button>
        </div>
        
        <div class="content">
            <!-- My Library Tab -->
            <div id="library" class="tab-content active">
                <h2>My Library</h2>
                <input type="text" class="search-box" id="librarySearch" placeholder="Search your library..." onkeyup="searchLibrary()">
                <div id="libraryContent">
                    <div class="loading">Loading your library...</div>
                </div>
            </div>
            
            <!-- Myrient Browser Tab -->
            <div id="browser" class="tab-content">
                <h2>Myrient Browser</h2>
                <div id="browserContent">
                    <div class="loading">Loading platforms...</div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2>Settings</h2>
                <div id="settingsContent">
                    <div class="loading">Loading settings...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTab = 'library';
        let libraryGames = [];
        let platforms = [];
        let settings = {};
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we're in Tauri environment
            if (typeof window.__TAURI__ !== 'undefined') {
                loadLibrary();
                loadPlatforms();
                loadSettings();
            } else {
                // Show error message if not in Tauri
                document.getElementById('libraryContent').innerHTML = 
                    '<div class="error">Tauri API not available. Please run this application through Tauri.</div>';
            }
        });
        
        // Tab switching
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            currentTab = tabName;
        }
        
        // Load library games
        async function loadLibrary() {
            try {
                const games = await window.__TAURI__.invoke('get_library_games');
                libraryGames = games;
                displayLibraryGames(games);
            } catch (error) {
                console.error('Failed to load library:', error);
                document.getElementById('libraryContent').innerHTML = 
                    '<div class="error">Failed to load library: ' + error + '</div>';
            }
        }
        
        // Display library games
        function displayLibraryGames(games) {
            const content = document.getElementById('libraryContent');
            
            if (games.length === 0) {
                content.innerHTML = '<div class="loading">No games found in your library.</div>';
                return;
            }
            
            const gamesHtml = games.map(game => `
                <div class="game-card">
                    <div class="game-title">${game.name}</div>
                    <div class="game-platform">${game.platform}</div>
                    ${game.rating ? `<div class="game-rating">‚≠ê ${game.rating}/10</div>` : ''}
                    ${game.summary ? `<div class="game-summary">${game.summary.substring(0, 100)}...</div>` : ''}
                    <div class="game-actions">
                        <button class="btn btn-primary" onclick="launchGame('${game.name}')">Launch</button>
                        <button class="btn btn-secondary" onclick="getGameMetadata('${game.name}')">Details</button>
                    </div>
                </div>
            `).join('');
            
            content.innerHTML = `<div class="games-grid">${gamesHtml}</div>`;
        }
        
        // Search library
        function searchLibrary() {
            const searchTerm = document.getElementById('librarySearch').value.toLowerCase();
            const filteredGames = libraryGames.filter(game => 
                game.name.toLowerCase().includes(searchTerm)
            );
            displayLibraryGames(filteredGames);
        }
        
        // Load platforms
        async function loadPlatforms() {
            try {
                const platformData = await window.__TAURI__.invoke('get_platforms');
                platforms = platformData;
                displayPlatforms(platformData);
            } catch (error) {
                console.error('Failed to load platforms:', error);
                document.getElementById('browserContent').innerHTML = 
                    '<div class="error">Failed to load platforms: ' + error + '</div>';
            }
        }
        
        // Display platforms
        function displayPlatforms(platformData) {
            const content = document.getElementById('browserContent');
            
            const platformsHtml = platformData.map(platform => `
                <div class="platform-card" onclick="browsePlatform('${platform.id}')">
                    <div class="platform-name">${platform.name}</div>
                    <div class="platform-dataset">${platform.dataset}</div>
                </div>
            `).join('');
            
            content.innerHTML = `
                <h3>Select a Platform</h3>
                <div class="platforms-grid">${platformsHtml}</div>
            `;
        }
        
        // Browse platform
        async function browsePlatform(platformId) {
            try {
                const games = await window.__TAURI__.invoke('browse_platform', { platformId });
                displayPlatformGames(games);
            } catch (error) {
                console.error('Failed to browse platform:', error);
                document.getElementById('browserContent').innerHTML = 
                    '<div class="error">Failed to browse platform: ' + error + '</div>';
            }
        }
        
        // Display platform games
        function displayPlatformGames(games) {
            const content = document.getElementById('browserContent');
            
            const gamesHtml = games.map(game => `
                <div class="game-card">
                    <div class="game-title">${game.name}</div>
                    <div class="game-platform">${game.platform}</div>
                    ${game.size ? `<div class="game-size">${game.size}</div>` : ''}
                    <div class="game-actions">
                        <button class="btn btn-primary" onclick="downloadGame('${game.name}', '${game.url || ''}')">Download</button>
                    </div>
                </div>
            `).join('');
            
            content.innerHTML = `
                <button class="btn btn-secondary" onclick="loadPlatforms()" style="margin-bottom: 20px;">‚Üê Back to Platforms</button>
                <div class="games-grid">${gamesHtml}</div>
            `;
        }
        
        // Load settings
        async function loadSettings() {
            try {
                const settingsData = await window.__TAURI__.invoke('get_settings');
                settings = settingsData;
                displaySettings(settingsData);
            } catch (error) {
                console.error('Failed to load settings:', error);
                document.getElementById('settingsContent').innerHTML = 
                    '<div class="error">Failed to load settings: ' + error + '</div>';
            }
        }
        
        // Display settings
        function displaySettings(settingsData) {
            const content = document.getElementById('settingsContent');
            
            content.innerHTML = `
                <div class="settings-section">
                    <h3>ROM Directories</h3>
                    <div class="setting-group">
                        <label class="setting-label">ROM Directories:</label>
                        <div id="romDirectories">
                            ${settingsData.rom_directories.map((dir, index) => `
                                <input type="text" class="setting-input" value="${dir}" 
                                       onchange="updateRomDirectory(${index}, this.value)" 
                                       style="margin-bottom: 10px;">
                            `).join('')}
                        </div>
                        <button class="btn btn-secondary" onclick="addRomDirectory()">Add Directory</button>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">Download Directory:</label>
                        <input type="text" class="setting-input" value="${settingsData.download_directory}" 
                               onchange="updateDownloadDirectory(this.value)">
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">API Key:</label>
                        <input type="password" class="setting-input" value="${settingsData.metadata_api_key}" 
                               onchange="updateApiKey(this.value)">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Actions</h3>
                    <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                    <button class="btn btn-secondary" onclick="startRomScan()">Start ROM Scan</button>
                </div>
            `;
        }
        
        // Game actions
        async function launchGame(gameName) {
            alert('Launching ' + gameName + '...');
        }
        
        async function getGameMetadata(gameName) {
            try {
                const metadata = await window.__TAURI__.invoke('get_game_metadata', { gameName });
                alert('Game Details:\n' + JSON.stringify(metadata, null, 2));
            } catch (error) {
                console.error('Failed to get metadata:', error);
                alert('Failed to get game metadata: ' + error);
            }
        }
        
        async function downloadGame(gameName, url) {
            try {
                const result = await window.__TAURI__.invoke('download_game', { gameName, url });
                alert('Download started: ' + result);
            } catch (error) {
                console.error('Failed to download:', error);
                alert('Failed to download game: ' + error);
            }
        }
        
        // Settings actions
        function updateRomDirectory(index, value) {
            settings.rom_directories[index] = value;
        }
        
        function addRomDirectory() {
            settings.rom_directories.push('');
            displaySettings(settings);
        }
        
        function updateDownloadDirectory(value) {
            settings.download_directory = value;
        }
        
        function updateApiKey(value) {
            settings.metadata_api_key = value;
        }
        
        async function saveSettings() {
            try {
                const result = await window.__TAURI__.invoke('save_settings', { settings });
                alert('Settings saved: ' + result);
            } catch (error) {
                console.error('Failed to save settings:', error);
                alert('Failed to save settings: ' + error);
            }
        }
        
        async function startRomScan() {
            try {
                const result = await window.__TAURI__.invoke('start_rom_scan');
                alert('ROM scan started: ' + result);
            } catch (error) {
                console.error('Failed to start scan:', error);
                alert('Failed to start ROM scan: ' + error);
            }
        }
    </script>
</body>
</html>